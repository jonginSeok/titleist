<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>XSLT Transform 테스트</title> <!-- css -->
	<link type="text/css" href="/wtopas/css/ui.tabs.css" rel="Stylesheet" media="print, projection, screen" />
	<!--/css -->

	<style type="text/css" media="screen, projection">
/* Not required for Tabs, just to make this demo look better..ㄸ */
body,h1,h2 {
	font-family: "Trebuchet MS", Trebuchet, Verdana, Helvetica, Arial, sans-serif;
}

h1 {
	margin: 1em 0 1.5em;
	font-size: 18px;
}

h2 {
	margin: 2em 0 1.5em;
	font-size: 16px;
}

p {
	margin: 0;
}

pre,pre+p,p+p {
	margin: 1em 0 0;
}

code {
	font-family: "Courier New", Courier, monospace;
}

textarea {
	width: 700px;
	height: 100px;
}
</style>

	<!-- jquery -->
	<script src="/wtopas/js/jquery-1.7.2.min.js" type="text/javascript"></script>
	<script src="/wtopas/js/i18n/grid.locale-en.js" type="text/javascript"></script>
	<script src="/wtopas/js/jquery.jqGrid.min.js" type="text/javascript"></script>
	<script src="/wtopas/js/xslt/XSLTransform.js" type="text/javascript"></script>
	<script src="/wtopas/js/ibe/jquery.com.toxslt.js" type="text/javascript"></script>
	<script src="/wtopas/js/ibe/jquery.com.form.js" type="text/javascript"></script>
	<script src="/wtopas/js/ibe/jquery.com.util.js" type="text/javascript"></script>

	<!--/jquery -->

	<!-- javascript -->
	<script type="text/javascript">
	var $k1 = jQuery.noConflict();
    
	$k1(document).ready(function() {
		var xml = '/wtopas/xml/front_b2c/B2C1020004.xml';

		$k1.selectajax(xml, 'POST', gfnFunc, 'text', 'param1=value1');
	});

	function gfnFunc(data) {
		//alert(data);
		var xmlStr = data;
		var xsl = '/wtopas/xsl/front_b2c/B2C1020004.xsl';
		var param = { section: 'somevalue', qsVariableName : 'true', comp : 'kb' };
		
		$k1("#tableDiv").toxslt('xmlstring', xmlStr, xsl, param, gfnInit);
	}
	
	function gfnInit() {
		setData();
		initEvent();
	}

	function initEvent() {
		$k1('input[id="reserveButton"]').toggle(function(){
			var selectRow =$k1(this).parent().parent();
			var selId = selectRow.attr("id");
			
			$k1("#hid_"+selId).show();
			$k1(this).attr("value", "닫기");
			
		}, function(){
			var selectRow =$k1(this).parent().parent();
			var selId = selectRow.attr("id");
			
			$k1("#hid_"+selId).hide();
			$k1(this).attr("value", "조회");
			
		});
		
		$k1('input[id="schButton"]').bind('click', function() {
			var parent = $k1(this).parent();
			alert(parent.find("#resvDpdate1").val());
			
		});
		/*
		
		$k1('input[id="schButton"]').click(function() {
			var parent = $k1(this).parent();
			alert(parent.find("#resvDpdate1").val());
			
		});
		*/
	}

	function setData() {
		var jsonData = '{"rowData":[{"city":"홍콩","air":"COYNE AW","amount":199000,"tax":"[?]","fee":"[?]","gubun":"성인","condition":"확정 보기","isDirect":"직항","reserve":""},';
		jsonData += '{"city":"홍콩","air":"COYNE AW","amount":199000,"tax":"[?]","fee":"[?]","gubun":"성인","condition":"확정 보기","isDirect":"직항","reserve":""}';
		jsonData += ']}';
	
		var tbody = $k1('#tblLow tbody');
		var copyLen = tbody.find('tr').length;
		var copyRow = tbody.find('tr:first');
		var hidRow = (copyLen > 1)? tbody.find('tr:last'):"";
		var obj = $k1.parseJSON(jsonData); 

		for(var r=0; r<obj.rowData.length; r++) {
			var newRow = copyRow.clone(true).appendTo(tbody);
			newRow.attr("id", newRow.attr("id")+(r+1));
			var dataId = newRow.attr("id");
			var col = 0;
			$k1.each(obj.rowData[r], function (key, state) { 
				var oldHtml = newRow.find('td:eq('+col+')').html();
				var newHtml = replaceAll(oldHtml, "row", state);
				newRow.find('td:eq('+col+')').html(newHtml);
				col++;
			});
			
			if(copyLen > 1) {
				newRow = hidRow.clone(true).appendTo(tbody);
				newRow.attr("id", "hid_"+dataId);
			}
		}
		
		copyRow.hide();
		
		if(copyLen > 1) hidRow.html("");
	}
	
	function replaceAll(str, searchStr, replaceStr) {
		 return str.split(searchStr).join(replaceStr);
	}
    </script>
	<!--/javascript -->
</head>
<body>
	<table>
		<tr><td><input type="checkbox" id="chk" name="chk" value="" /></td></tr>
	</table>	
	<div id="tableDiv"></div>
</body>

</html>