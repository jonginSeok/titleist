<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- <link rel="Stylesheet" type="text/css" href="/css/pilot/p_style.css" /> -->
<link rel="Stylesheet" type="text/css" href="/css/style.css" />
<style>
#k1_pop_wrap .k1_page_num {
	margin: 10px auto;
	width: 350px;
	height: 16px;
	text-align: center;
	font-weight: bold;
}

#k1_pop_wrap .k1_page_num a.active {
	color: #4272d4;
}

#k1_pop_wrap .k1_page_num img {
	vertical-align: middle;
}
</style>
<link rel="stylesheet" type="text/css" href="/css/ui.jqgrid.css" />
<script src="/js/plugin/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="/js/plugin/XSLTransform.js" type="text/javascript"></script>
<!-- pager 표시를 위해서 grid.locale-kr.js include 해야 한다.  -->
<script src="/js/plugin/grid.locale-kr.js" type="text/javascript"></script>
<script src="/js/plugin/jquery.jqGrid.src.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.grid.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.form.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.util.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.uitab.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.pager.js" type="text/javascript"></script>
<script src="/js/lib/jquery.com.js" type="text/javascript"></script>
<script type="text/javascript">
	var $k1 = jQuery.noConflict();
	var xmlData = new Object();
	$k1(document).ready(
		function() {
			//Grid title 
			var gTitle = [ 'Inv No', 'Date', 'Client', 'Amount', 'Tax', 'Total', 'Notes' ];
			//Grid Model 
			var gModel = [
					{ name : 'id'		, index : 'id'		, width : 40	, align : "center"	, editable : true },
					{ name : 'invdate'	, index : 'invdate'	, width : 100	, align : "center"	, editable : false	, sorttype : "date" 	, summaryType : 'count', summaryTpl : '({0}) total' },
					{ name : 'name'		, index : 'name'	, width : 100	, align : "center"	, editable : true	, formatter : 'select'	, edittype : "select", editoptions : { value : "1:aaa;2:bbb;3:ccc" } },
					{ name : 'amount'	, index : 'amount'	, width : 100	, align : "right"	, editable : true	, sorttype : "float"	, formatter : 'number' /* or 'currency' */, formatoptions : { thousandsSeparator : ',' } },
					{ name : 'tax'		, index : 'tax'		, width : 100	, align : "right"	, editable : true	, sorttype : "float"	, formatter : "currency" /* formatter : "number" */ , summaryType : 'sum', summaryTpl : '<b>{0}</b>', validate : {
							fnc : [ $k1.gridvalidate.require,
									//$k1.gridvalidate.number,
									$k1.gridvalidate.minvalue,
									$k1.gridvalidate.maxvalue ],
							limit : [ 'none'/* , 'none' */, '10', '50' ]
						}
					}, 
					{ name : 'total'	, index : 'total'	, width : 100	, align : "right"	, editable : true	, sorttype : "float" }, 
					{ name : 'note'		, index : 'note'	, width : 200	, align : "left"	, editable : false	, sorttype : "date"	, sortable : false	, formatter : $k1.gridformatter.dateTimeFormat, formatoptions : { dateformat : 'datetime'/* or 'datehhmm' or 'date' */ }, unformat : $k1.gridformatter.removeFormatter }
				];

			var options = {
				multiselect : true,
				//multiboxonly:true ,
				height : 'auto',
				width : '100%', //895 
				autowidth : true,
				sortfnc : sort_fnc,
				rowEditable : true,
				constraints : { pkey : [ 'id', 'invdate' ], editable : [ true, false ] },
				prmNames : { page : "spage", rows : "srows", sort : "sortcol", order : "orderby" },
				xmlReader : { root : "data", row : "list", repeatitems : false, id : "id" },
				grouping : true,
				groupingView : {
					groupField : [ 'name' ],
					groupColumnShow : [ true ],
					groupText : [ '<b>{0}</b>' ],
					groupCollapse : false,
					groupOrder : [ 'asc' ],
					groupSummary : [ true ],
					showSummaryOnHide : true,
					groupDataSorted : true
				},
				footerrow : true,
				userDataOnFooter : true,

				userData : {
					col : [ 'invdate', 'tax' ],
					cal : [ '', 'sum' ]
				}
			};

			var events = {
				loadComplete : gfnPaging1LoadComplete
			};

			//1. 기본적인 Grid을 만든다. : 화면 로딩시 바로 데이타 조회
			$k1("#tbl_page1").grid('../xsl/paging_data3.xml', gTitle, gModel, options, events);

			//onloadCallback 함수에서 토탈값을 구해서 넣어준다 invdate:Text문구 넣을 컴럼, tax:토탈값이 들어갈 컬럼명
			$k1("#tbl_page1").jqGrid('footerData', 'set', {
				invdate : 'Total',
				tax : '1100'
			});

			$k1('#tbl_page1').grid('setGridParam', {
				onSelectRow : function(id) {
					var editOption = {
						"rowid" : id,
						"keys" : true,
						"oneditfunc" : onEdit
						
					//"successfunc" : success,
					//"url" : null,
					//"extraparam" : {},
					//"aftersavefunc" : afterSave,
					//"errorfunc": null,
					//"afterrestorefunc" : afterRestore,
					//"restoreAfterError" : true,
					//"mtype" : "POST"
					};
					//그리드 옵션의 rowEditable의 값에 영향을 받음.
					$k1('#tbl_page1').grid('openRowEdit', editOption);

				}
			
			//, beforeSelectRow : function(rowid, e){
			//	var i = $k1.jgrid.getCellIndex($k1(e.target).closest('td')[0]);
			//	//var i = e.target.cellIndex;
			//	var cm = $k1('#tbl_page1').grid('getGridParam', 'colModel');
			//	console.log(e);
			//	console.log(i);
			//	console.log(cm[i]);
			//	return (cm[i].name === 'cb');
			//}
			});

			$k1('#addBtn').bind('click', function() {
				$k1("#tbl_page1").grid('addRowWithoutUpdate');
				$k1("#tbl_page1").grid('setGridStyle', 'vof_list');
			});

			$k1('#searchBtn').bind('click', function() {
				$k1('#addBtn').attr('disabled', false);
				$k1("#tbl_page1").grid('selectData', '../xsl/paging_data3.xml', 'frm');
			});

			$k1('#tojsonBtn').bind('click', function() {
				var lastSelRow = $k1("#tbl_page1").grid('getGridParam', 'lastSelRow');
				if (lastSelRow != 'none') {
					if ($k1("#tbl_page1").grid('getGridParam', 'rowEditable')) {
						var flag = $k1("#tbl_page1").grid('setEditRowToGrid', lastSelRow);
						if (!flag)
							return;
						if ($k1.util.isNull($k1("#tbl_page1").grid('getGridParam', 'updateData'))) {
							$k1("#tbl_page1").grid('setGridParamNoReload', {
										lastSelRow : 'none'
									});
							return;
						}
					}

					var jsonStr = $k1("#tbl_page1").grid('getUpdateColDataByJsonString');
					alert(jsonStr);
				}
			});

			$k1('#removeBtn').bind('click', function() {
				$k1("#tbl_page1").grid('getSelectedRowsPKey2JsonString');
				$k1("#tbl_page1").grid('restoreInputRow');
				$k1("#tbl_page1").grid('setGridParamNoReload', {
					rowEditable : true
				});
			});

			$k1('#vBtn').bind('click', function() {
				var ret = $k1("#tbl_page1").grid('newDataValidate');
				if (ret) {
					//submit
				}
			});
		} // End function
	);

	function gfnPaging1LoadComplete() {
		//그리드 스타일 지정
		$k1("#tbl_page1").grid('setGridStyle', 'vof_list');
		$k1("#tbl_page1").grid('setGridParamNoReload', {
			aaaaa : 'aaa'
		});
		
		//console.log('aaaaa : '+ $k1("#tbl_page1").grid('getGridParam', 'aaaaa'));
		//console.log('pagingType : ' + $k1("#tbl_page1").grid('getGridParam', 'pagingType'));
		//console.log('===========================================');
		//console.log(xmlData);
	}

	function onEdit() {
		$k1('#addBtn').attr('disabled', true);
		//그리드 edit row에서 엔터 키 막음
		$k1("#tbl_page1 tr").unbind('keydown');
	}

	function success() {
		//alert('success');
	}

	function afterSave() {
		//alert('afterSave');
	}

	function afterRestore() {
		//alert('afterRestore');
	}

	function sort_fnc() {
		$k1("#tbl_page1").grid('setPostDataFromForm', 'frm');
		//console.log($k1("#frm").serialize());
	}

	function openForm(str) {
		alert(str);
	}
</script>
</head>
<body>
	<div id="k1_pop_wrap">
		<div class="header">
			<h1 class="tit">그리드소계합계</h1>
			<img src="/imgs/airA/btn/btn_p_close.gif" alt="닫기" class="close" />
		</div>
		<div class="popup">
			<div class="contents">
				<!-- 컨텐츠 -->
				<div id="k1_sale_wrap">
					<div id="tab_div_1" class="sale_form2 k1_mt5">
						<div class="detail4">
							<div class="k1_mt5">
								<table id="tbl_page1">
								</table>
							</div>
							<div class="k1_page_num" id="page_num1"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>